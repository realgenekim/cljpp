(ns examples.program38)
(defn diff [expr var] (cond (and (vector? expr) (= (first expr) :+)) (let [[_ a b] expr] (let [da (diff a var) db (diff b var)] (cond (and (= da [:const 0]) (= db [:const 0])) [:const 0] (= da [:const 0]) db (= db [:const 0]) da :else [:+ da db]))) (and (vector? expr) (= (first expr) :*)) (let [[_ a b] expr] (let [da (diff a var) db (diff b var)] (let [term1 [:* da b] term2 [:* a db]] (cond (and (= da [:const 0]) (= db [:const 0])) [:const 0] (= da [:const 0]) term2 (= db [:const 0]) term1 :else [:+ term1 term2])))) (and (vector? expr) (= (first expr) :exp)) (let [[_ a] expr] (let [da (diff a var)] (if (= da [:const 0]) [:const 0] [:* da [:exp a]]))) (and (vector? expr) (= (first expr) :var)) (let [[_ x] expr] (if (= x var) [:const 1] [:const 0])) (and (vector? expr) (= (first expr) :const)) [:const 0] :else [:const 0]))
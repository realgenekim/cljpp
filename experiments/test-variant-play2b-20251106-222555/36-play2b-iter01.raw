PUSH-( ns examples.program36 POP

PUSH-( defn m-return PUSH-[ v POP
  PUSH-( fn PUSH-[ input POP
    PUSH-[ PUSH-[ v input POP POP POP-ALL

PUSH-( defn m-bind PUSH-[ parser f POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( let PUSH-[ result PUSH-( parser input POP POP
      PUSH-( if PUSH-( empty? result POP
        PUSH-[ POP
        PUSH-( let PUSH-[ PUSH-[ PUSH-[ v remaining POP POP PUSH-( first result POP
               next-parser PUSH-( f v POP POP
          PUSH-( next-parser remaining POP POP POP POP POP-ALL

PUSH-( def mzero
  PUSH-( fn PUSH-[ input POP PUSH-[ POP POP POP

PUSH-( defn mplus PUSH-[ p1 p2 POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( let PUSH-[ r1 PUSH-( p1 input POP POP
      PUSH-( if PUSH-( seq r1 POP
        r1
        PUSH-( p2 input POP POP POP POP POP-ALL

PUSH-( defn parse-char PUSH-[ pred POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( if PUSH-( and PUSH-( seq input POP PUSH-( pred PUSH-( first input POP POP POP
      PUSH-[ PUSH-[ PUSH-( first input POP PUSH-( subs input 1 POP POP POP
      PUSH-[ POP POP POP POP-ALL

PUSH-( defn parse-digit PUSH-[ POP
  PUSH-( parse-char PUSH-( fn PUSH-[ c POP PUSH-( Character/isDigit c POP POP POP-ALL

PUSH-( defn parse-number PUSH-[ POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( let PUSH-[ result PUSH-( PUSH-( parse-digit POP input POP POP
      PUSH-( if PUSH-( seq result POP
        PUSH-( let PUSH-[ PUSH-[ PUSH-[ digit rest-input POP POP PUSH-( first result POP
               more PUSH-( PUSH-( parse-number POP rest-input POP POP
          PUSH-( if PUSH-( seq more POP
            PUSH-( let PUSH-[ PUSH-[ PUSH-[ num remaining POP POP PUSH-( first more POP POP
              PUSH-[ PUSH-[ PUSH-( read-string PUSH-( str digit num POP POP remaining POP POP POP
            PUSH-[ PUSH-[ PUSH-( read-string PUSH-( str digit POP POP rest-input POP POP POP POP
        PUSH-[ POP POP POP POP POP-ALL

PUSH-( defn parse-op PUSH-[ op POP
  PUSH-( parse-char PUSH-( fn PUSH-[ c POP PUSH-( = c op POP POP POP-ALL

PUSH-( declare parse-expr POP

PUSH-( defn parse-term PUSH-[ POP
  PUSH-( mplus PUSH-( parse-number POP PUSH-( parse-expr POP POP-ALL

PUSH-( defn parse-expr PUSH-[ POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( let PUSH-[ left PUSH-( PUSH-( parse-term POP input POP POP
      PUSH-( if PUSH-( seq left POP
        PUSH-( let PUSH-[ PUSH-[ PUSH-[ lval rest1 POP POP PUSH-( first left POP
               op PUSH-( PUSH-( mplus PUSH-( parse-op \+ POP PUSH-( parse-op \- POP POP rest1 POP POP
          PUSH-( if PUSH-( seq op POP
            PUSH-( let PUSH-[ PUSH-[ PUSH-[ op-char rest2 POP POP PUSH-( first op POP
                   right PUSH-( PUSH-( parse-term POP rest2 POP POP
              PUSH-( if PUSH-( seq right POP
                PUSH-( let PUSH-[ PUSH-[ PUSH-[ rval rest3 POP POP PUSH-( first right POP POP
                  PUSH-[ PUSH-[ PUSH-( if PUSH-( = op-char \+ POP PUSH-( + lval rval POP PUSH-( - lval rval POP POP rest3 POP POP POP
                PUSH-[ POP POP POP
            left POP POP
        PUSH-[ POP POP POP POP-ALL

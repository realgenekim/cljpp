PUSH-( ns examples.program31 POP-ALL

PUSH-( defn from PUSH-[ data POP
  PUSH-( fn PUSH-[ POP data POP-ALL

PUSH-( defn where PUSH-[ pred POP
  PUSH-( fn PUSH-[ data POP
    PUSH-( filter pred data POP-ALL

PUSH-( defn select PUSH-[ & fields POP
  PUSH-( fn PUSH-[ data POP
    PUSH-( map PUSH-( fn PUSH-[ row POP
      PUSH-( select-keys row fields POP POP data POP-ALL

PUSH-( defn order-by PUSH-[ field POP
  PUSH-( fn PUSH-[ data POP
    PUSH-( sort-by field data POP-ALL

PUSH-( def sample-data
  PUSH-[
    PUSH-{ :id 1 :name "Alice" :age 30 POP
    PUSH-{ :id 2 :name "Bob" :age 25 POP
    PUSH-{ :id 3 :name "Charlie" :age 35 POP
    PUSH-{ :id 4 :name "Diana" :age 28 POP
  POP-ALL

PUSH-( def result
  PUSH-( -> sample-data
    PUSH-( from sample-data POP
    PUSH-( where PUSH-( fn PUSH-[ x POP PUSH-( > PUSH-( :age x POP 26 POP POP POP
    PUSH-( select :name :age POP
    PUSH-( order-by :age POP
  POP-ALL

PUSH-( println result POP-ALL
PUSH-( ns examples.program32 POP

PUSH-( defn get-box PUSH-[ board row col POP
  PUSH-( let PUSH-[
    box-row PUSH-( * 3 PUSH-( quot row 3 POP POP
    box-col PUSH-( * 3 PUSH-( quot col 3 POP POP
  POP
    PUSH-( for PUSH-[ r PUSH-( range box-row PUSH-( + box-row 3 POP POP
              c PUSH-( range box-col PUSH-( + box-col 3 POP POP POP
      PUSH-( get-in board PUSH-[ r c POP POP
    POP
  POP
POP

PUSH-( defn valid? PUSH-[ board row col num POP
  PUSH-( let PUSH-[
    row-vals PUSH-( nth board row POP
    col-vals PUSH-( map #PUSH-( nth % col POP board POP
    box-vals PUSH-( get-box board row col POP
  POP
    PUSH-( and
      PUSH-( not PUSH-( some #PUSH-( = % num POP row-vals POP POP
      PUSH-( not PUSH-( some #PUSH-( = % num POP col-vals POP POP
      PUSH-( not PUSH-( some #PUSH-( = % num POP box-vals POP POP
    POP
  POP
POP

PUSH-( defn find-empty PUSH-[ board POP
  PUSH-( first
    PUSH-( for PUSH-[ r PUSH-( range 9 POP
              c PUSH-( range 9 POP
              :when PUSH-( zero? PUSH-( get-in board PUSH-[ r c POP POP POP POP
      PUSH-[ r c POP
    POP
  POP
POP

PUSH-( defn solve-sudoku PUSH-[ board POP
  PUSH-( if-let PUSH-[ PUSH-[ row col POP PUSH-( find-empty board POP POP
    PUSH-( loop PUSH-[ num 1 POP
      PUSH-( cond
        PUSH-( > num 9 POP nil
        PUSH-( valid? board row col num POP
          PUSH-( let PUSH-[ new-board PUSH-( assoc-in board PUSH-[ row col POP num POP POP
            PUSH-( or
              PUSH-( solve-sudoku new-board POP
              PUSH-( recur PUSH-( inc num POP POP
            POP
          POP
        :else PUSH-( recur PUSH-( inc num POP POP
      POP
    POP
    board
  POP
POP

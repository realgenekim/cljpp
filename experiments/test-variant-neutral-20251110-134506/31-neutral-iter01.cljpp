PUSH-( ns examples.program31 POP

PUSH-( defn from PUSH-[ data POP
  PUSH-( fn PUSH-[ query POP
    PUSH-( query data POP
  POP
POP

PUSH-( defn where PUSH-[ pred POP
  PUSH-( fn PUSH-[ data POP
    PUSH-( filter pred data POP
  POP
POP

PUSH-( defn select PUSH-[ & fields POP
  PUSH-( fn PUSH-[ data POP
    PUSH-( map PUSH-( fn PUSH-[ row POP
      PUSH-( select-keys row fields POP
    POP data POP
  POP
POP

PUSH-( defn order-by PUSH-[ field POP
  PUSH-( fn PUSH-[ data POP
    PUSH-( sort-by field data POP
  POP
POP

PUSH-( def sample-data
  PUSH-[ PUSH-{ :id 1 :name "Alice" :age 30 :dept "Engineering" POP
     PUSH-{ :id 2 :name "Bob" :age 25 :dept "Sales" POP
     PUSH-{ :id 3 :name "Charlie" :age 35 :dept "Engineering" POP
     PUSH-{ :id 4 :name "Diana" :age 28 :dept "Marketing" POP POP
POP

PUSH-( def result
  PUSH-( -> sample-data
    PUSH-( where PUSH-( fn PUSH-[ r POP PUSH-( >= PUSH-( :age r POP 28 POP POP POP
    PUSH-( select :name :dept POP
    PUSH-( order-by :name POP
  POP
POP

PUSH-( defn -main PUSH-[ & args POP
  PUSH-( println "Query result:" POP
  PUSH-( doseq PUSH-[ row result POP
    PUSH-( println row POP
  POP
POP
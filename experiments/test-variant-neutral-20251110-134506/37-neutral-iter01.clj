(ns examples.program37 (:require [reagent.core :as r] [reagent.ratom :refer [reaction]]))
(defn use-state [initial-value] (r/atom initial-value))
(defn use-effect [effect-fn deps] (let [prev-deps (atom nil)] (fn [] (when (not= @prev-deps deps) (reset! prev-deps deps) (effect-fn)))))
(defn use-fetch [url] (let [loading (r/atom true) error (r/atom nil) data (r/atom nil)] (letfn [(fetch-data [] (reset! loading true) (reset! error nil) (-> (js/fetch url) (.then (fn [response] (if (.-ok response) (.json response) (throw (js/Error. (str "HTTP error: " (.-status response))))))) (.then (fn [json] (reset! data (js->clj json :keywordize-keys true)) (reset! loading false))) (.catch (fn [err] (reset! error (.-message err)) (reset! loading false)))))] (fetch-data) {:loading loading, :refetch fetch-data, :error error, :data data})))
(defn user-profile [{:keys [user-id]}] (let [count-state (use-state 0) {:keys [loading error data refetch]} (use-fetch (str "https://api.example.com/users/" user-id))] (r/create-class {:component-did-mount (fn [this] (js/console.log "Component mounted")), :reagent-render (fn [] [:div [:h2 "User Profile"] [:div [:button {:on-click (fn [] (swap! count-state inc))} (str "Clicked " @count-state " times")]] (cond @loading [:p "Loading..."] @error [:div [:p (str "Error: " @error)] [:button {:on-click refetch} "Retry"]] @data [:div [:h3 (get-in @data [:name])] [:p (get-in @data [:email])] [:button {:on-click refetch} "Refresh"]] :else [:p "No data"])])})))
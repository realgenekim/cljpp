PUSH-( ns examples.program18 POP-ALL

PUSH-( defn wrap-logging PUSH-[ handler POP
  PUSH-( fn PUSH-[ request POP
    PUSH-( println "Request:" PUSH-( :uri request POP POP
    PUSH-( handler request POP-ALL

PUSH-( defn wrap-auth PUSH-[ handler POP
  PUSH-( fn PUSH-[ request POP
    PUSH-( if PUSH-( :authenticated? request POP
      PUSH-( handler request POP
      PUSH-{ :status 401 :body "Unauthorized" POP-ALL

PUSH-( defn app-handler PUSH-[ request POP
  PUSH-( case PUSH-( :uri request POP
    "/home" PUSH-{ :status 200 :body "Home" POP
    "/about" PUSH-{ :status 200 :body "About" POP
    PUSH-{ :status 404 :body "Not Found" POP-ALL

PUSH-( def app
  PUSH-( -> app-handler
    wrap-auth
    wrap-logging POP-ALL
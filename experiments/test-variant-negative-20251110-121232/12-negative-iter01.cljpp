(ns examples.program12)

(defn custom-transducer
  []
  (comp
    (filter even?)
    (map #(* 2 %))))

(defn stateful-transducer
  []
  (fn [rf]
    (let [seen (atom #{})]
      (fn
        ([] (rf))
        ([result] (rf result))
        ([result input]
         (if (contains? @seen input)
           result
           (do
             (swap! seen conj input)
             (rf result input))))))))

(defn process-with-transducers
  [coll]
  (into []
        (comp
          (custom-transducer)
          (stateful-transducer))
        coll))

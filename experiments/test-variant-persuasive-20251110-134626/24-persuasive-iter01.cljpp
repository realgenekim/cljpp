PUSH-( ns examples.program24 POP

PUSH-( defmacro when-let-all
  PUSH-[ bindings & body POP
  PUSH-( if PUSH-( seq bindings POP
    PUSH-( let PUSH-[ PUSH-[ sym expr POP PUSH-( take 2 bindings POP POP
      PUSH-` PUSH-( let PUSH-[ ~~sym ~~expr POP
        PUSH-( when ~~sym
          PUSH-( when-let-all ~~PUSH-( vec PUSH-( drop 2 bindings POP POP
            ~~@body
          POP
        POP
      POP
      POP
    POP
    PUSH-` PUSH-( do ~~@body POP
  POP
POP

PUSH-( defmacro defn-timed
  PUSH-[ name & fdecl POP
  PUSH-` PUSH-( defn ~~name ~~@fdecl
    PUSH-( let PUSH-[ start# PUSH-( System/nanoTime POP
          result# PUSH-( ~~PUSH-( cons name PUSH-( mapv PUSH-( fn PUSH-[ arg POP PUSH-` ~~arg POP POP PUSH-( first fdecl POP POP POP POP POP
          end# PUSH-( System/nanoTime POP POP
      PUSH-( println PUSH-( str "Timing " '~~name ": " PUSH-( / PUSH-( - end# start# POP 1000000.0 POP " ms" POP POP
      result#
    POP
  POP
  POP
POP
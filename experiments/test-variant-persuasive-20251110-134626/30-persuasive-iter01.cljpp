PUSH-( ns examples.program30 POP

PUSH-( defrecord SkipNode PUSH-[ value next down POP POP

PUSH-( deftype SkipList PUSH-[ head height cnt POP
  clojure.lang.ISeq
  PUSH-( seq PUSH-[ this POP
    PUSH-( when head
      PUSH-( loop PUSH-[ node head
                    acc PUSH-[ POP POP
        PUSH-( if node
          PUSH-( recur PUSH-( :next node POP
                       PUSH-( conj acc PUSH-( :value node POP POP POP
          PUSH-( seq PUSH-( reverse acc POP POP
        POP
      POP
    POP
  POP
  
  PUSH-( first PUSH-[ this POP
    PUSH-( when head PUSH-( :value head POP POP
  POP
  
  PUSH-( next PUSH-[ this POP
    PUSH-( when head
      PUSH-( let PUSH-[ n PUSH-( :next head POP POP
        PUSH-( when n
          PUSH-( SkipList. n height PUSH-( dec cnt POP POP
        POP
      POP
    POP
  POP
  
  PUSH-( more PUSH-[ this POP
    PUSH-( or PUSH-( .next this POP PUSH-( list POP POP
  POP
  
  clojure.lang.ICollection
  PUSH-( cons PUSH-[ this x POP
    PUSH-( let PUSH-[ new-node PUSH-( ->SkipNode x head nil POP POP
      PUSH-( SkipList. new-node height PUSH-( inc cnt POP POP
    POP
  POP
  
  PUSH-( empty PUSH-[ this POP
    PUSH-( SkipList. nil 0 0 POP
  POP
  
  PUSH-( equiv PUSH-[ this other POP
    PUSH-( and PUSH-( instance? SkipList other POP
              PUSH-( = cnt PUSH-( .-cnt other POP POP
              PUSH-( = PUSH-( seq this POP PUSH-( seq other POP POP POP
  POP
  
  clojure.lang.ICounted
  PUSH-( count PUSH-[ this POP cnt POP
POP

PUSH-( defn make-skip-list PUSH-[ & items POP
  PUSH-( reduce
    PUSH-( fn PUSH-[ sl item POP PUSH-( cons sl item POP POP
    PUSH-( SkipList. nil 0 0 POP
    PUSH-( reverse items POP
  POP
POP
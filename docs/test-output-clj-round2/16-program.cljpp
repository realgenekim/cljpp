PUSH-( ns examples.program16 POP

PUSH-( defn parse-char PUSH-[ expected POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( if PUSH-( and PUSH-( seq input POP PUSH-( = expected PUSH-( first input POP POP POP
      PUSH-[ PUSH-{ :result expected :remaining PUSH-( rest input POP POP POP
      nil
    POP
  POP
POP

PUSH-( defn return PUSH-[ value POP
  PUSH-( fn PUSH-[ input POP
    PUSH-[ PUSH-{ :result value :remaining input POP POP
  POP
POP

PUSH-( defn bind PUSH-[ parser f POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( when-let PUSH-[ result PUSH-( parser input POP POP
      PUSH-( let PUSH-[ next-parser PUSH-( f PUSH-( :result result POP POP POP
        PUSH-( next-parser PUSH-( :remaining result POP POP
      POP
    POP
  POP
POP

PUSH-( defn choice PUSH-[ parser1 parser2 POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( or PUSH-( parser1 input POP PUSH-( parser2 input POP POP
  POP
POP

PUSH-( defn many PUSH-[ parser POP
  PUSH-( fn PUSH-[ input POP
    PUSH-( loop PUSH-[ results PUSH-[ POP current-input input POP
      PUSH-( if-let PUSH-[ result PUSH-( parser current-input POP POP
        PUSH-( recur
          PUSH-( conj results PUSH-( :result result POP POP
          PUSH-( :remaining result POP
        POP
        PUSH-[ PUSH-{ :result results :remaining current-input POP POP
      POP
    POP
  POP
POP

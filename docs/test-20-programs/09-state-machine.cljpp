PUSH-( ns examples.fsm POP

PUSH-( def transitions PUSH-{
  :idle PUSH-{ :start :running :stop :idle POP
  :running PUSH-{ :pause :paused :stop :stopped POP
  :paused PUSH-{ :resume :running :stop :stopped POP
  :stopped PUSH-{ :reset :idle POP
POP POP

PUSH-( defn transition PUSH-[ state event POP
  PUSH-( get-in transitions PUSH-[ state event POP POP
POP

PUSH-( defn process-events PUSH-[ initial-state events POP
  PUSH-( reduce
    PUSH-( fn PUSH-[ state event POP
      PUSH-( let PUSH-[ next-state PUSH-( transition state event POP POP
        PUSH-( if next-state
          PUSH-( do
            PUSH-( println "Transition:" state "->" event "->" next-state POP
            next-state
          POP
          PUSH-( do
            PUSH-( println "Invalid transition:" state event POP
            state
          POP
        POP
      POP
    POP
    initial-state
    events
  POP
POP

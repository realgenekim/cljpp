PUSH-( ns examples.async
  PUSH-( :require PUSH-[ clojure.core.async :as async :refer PUSH-[ chan go go-loop >! <! <!! >!! close! POP POP POP
POP

PUSH-( defn create-pipeline PUSH-[ input-ch POP
  PUSH-( let PUSH-[
    step1-ch PUSH-( chan 10 POP
    step2-ch PUSH-( chan 10 POP
    step3-ch PUSH-( chan 10 POP
  POP
    PUSH-( go-loop PUSH-[ POP
      PUSH-( when-let PUSH-[ v PUSH-( <! input-ch POP POP
        PUSH-( >! step1-ch PUSH-( * v 2 POP POP
        PUSH-( recur POP
      POP
      PUSH-( close! step1-ch POP
    POP

    PUSH-( go-loop PUSH-[ POP
      PUSH-( when-let PUSH-[ v PUSH-( <! step1-ch POP POP
        PUSH-( >! step2-ch PUSH-( inc v POP POP
        PUSH-( recur POP
      POP
      PUSH-( close! step2-ch POP
    POP

    PUSH-( go-loop PUSH-[ acc PUSH-[ POP POP
      PUSH-( if-let PUSH-[ v PUSH-( <! step2-ch POP POP
        PUSH-( recur PUSH-( conj acc v POP POP
        acc
      POP
    POP
  POP
POP

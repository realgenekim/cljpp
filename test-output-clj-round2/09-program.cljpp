PUSH-( ns examples.program9 POP

PUSH-( def transitions
  PUSH-{ :idle PUSH-{ :start :running
                      :stop :idle POP
     :running PUSH-{ :pause :paused
                     :stop :idle POP
     :paused PUSH-{ :resume :running
                    :stop :idle POP POP POP

PUSH-( defn apply-event
  PUSH-[ state event POP
  PUSH-( get-in transitions PUSH-[ state event POP state POP POP

PUSH-( defn run-machine
  PUSH-[ initial-state events POP
  PUSH-( reduce apply-event initial-state events POP POP

PUSH-( defn -main
  PUSH-[ & args POP
  PUSH-( let PUSH-[ events PUSH-[ :start :pause :resume :stop POP
            final-state PUSH-( run-machine :idle events POP POP
    PUSH-( println "Starting state:" :idle POP
    PUSH-( println "Events:" events POP
    PUSH-( println "Final state:" final-state POP POP POP
